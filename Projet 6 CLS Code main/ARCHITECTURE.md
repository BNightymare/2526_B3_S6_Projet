# Architecture du SystÃ¨me ğŸ—ï¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ROBOT SUIVEUR DE LIGNE                  â”‚
â”‚                         (main.py)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                 â”‚                 â”‚
            â–¼                 â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   CAPTEURS    â”‚ â”‚    MOTEURS    â”‚ â”‚     IMU      â”‚
    â”‚   (sensors/)  â”‚ â”‚   (motor/)    â”‚ â”‚   (imu/)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                 â”‚
            â”‚                 â”‚                 â”‚
            â–¼                 â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   MCP3208     â”‚ â”‚   TMC2225     â”‚ â”‚   LSM6DSOX   â”‚
    â”‚   (8 IR)      â”‚ â”‚  (Pas-Ã -pas)  â”‚ â”‚(Accel+Gyro)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚                 â”‚
            â”‚                 â”‚                 â”‚
            â–¼                 â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SPI Bus 0    â”‚ â”‚  GPIO Pins    â”‚ â”‚  I2C Bus 1   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


```

## Flux de DonnÃ©es ğŸ”„

```
1. LECTURE DES CAPTEURS
   â”œâ”€ MCP3208 lit 8 capteurs IR via SPI
   â””â”€ Retourne tensions (0-3.3V)

2. ANALYSE DE POSITION
   â”œâ”€ line_detector.py compare avec seuil
   â””â”€ DÃ©termine: Gauche / Centre / Droite / Aucune

3. DÃ‰CISION DE MOUVEMENT
   â”œâ”€ Centre â†’ Avancer tout droit
   â”œâ”€ Gauche â†’ Tourner Ã  gauche
   â”œâ”€ Droite â†’ Tourner Ã  droite
   â””â”€ Aucune â†’ ArrÃªt/Recherche

4. CONTRÃ”LE DES MOTEURS
   â”œâ”€ DualMotorController coordonne les 2 moteurs
   â””â”€ TMC2225 gÃ©nÃ¨re les impulsions STEP

5. STABILISATION (Optionnel)
   â”œâ”€ IMU lit accÃ©lÃ©ration et gyroscope
   â””â”€ Ajuste la trajectoire


```

## HiÃ©rarchie des Modules ğŸ“¦

```
main.py
â”‚
â”œâ”€â”€ config.py (Configuration globale)
â”‚
â”œâ”€â”€ sensors/
â”‚   â”œâ”€â”€ MCP3208.py
â”‚   â”‚   â””â”€â”€ Classe MCP3208
â”‚   â”‚       â”œâ”€â”€ read_channel()
â”‚   â”‚       â”œâ”€â”€ read_voltage()
â”‚   â”‚       â””â”€â”€ read_all_channels()
â”‚   â”‚
â”‚   â””â”€â”€ line_detector.py
â”‚       â””â”€â”€ detect_line()
â”‚
â”œâ”€â”€ motor/
â”‚   â”œâ”€â”€ config.py (Pins et paramÃ¨tres)
â”‚   â”‚
â”‚   â”œâ”€â”€ driver.py
â”‚   â”‚   â””â”€â”€ Classe TMC2225
â”‚   â”‚       â”œâ”€â”€ set_speed()
â”‚   â”‚       â”œâ”€â”€ set_direction()
â”‚   â”‚       â”œâ”€â”€ step()
â”‚   â”‚       â””â”€â”€ rotate()
â”‚   â”‚
â”‚   â”œâ”€â”€ controller.py
â”‚   â”‚   â””â”€â”€ Classe DualMotorController
â”‚   â”‚       â”œâ”€â”€ rotate_both()
â”‚   â”‚       â”œâ”€â”€ rotate_sync()
â”‚   â”‚       â””â”€â”€ stop_all()
â”‚   â”‚
â”‚   â””â”€â”€ utils.py (Fonctions utilitaires)
â”‚
â””â”€â”€ imu/
    â”œâ”€â”€ setting.py (Configuration LSM6DSOX)
    â”‚
    â””â”€â”€ drv_lsm6dsow.py
        â””â”€â”€ Classe drv_lsm6dsow
            â”œâ”€â”€ init_lsm6dsox()
            â”œâ”€â”€ read_accel()
            â””â”€â”€ read_gyro()


```

## Communication Hardware ğŸ”Œ

```
Raspberry Pi GPIO
â”‚
â”œâ”€â”€ SPI0 (Capteurs IR)
â”‚   â”œâ”€â”€ MOSI (GPIO 10) â”€â”€â”€â–º MCP3208 DIN
â”‚   â”œâ”€â”€ MISO (GPIO 9)  â—„â”€â”€â”€ MCP3208 DOUT
â”‚   â”œâ”€â”€ SCLK (GPIO 11) â”€â”€â”€â–º MCP3208 CLK
â”‚   â””â”€â”€ CE0  (GPIO 8)  â”€â”€â”€â–º MCP3208 CS
â”‚
â”œâ”€â”€ GPIO (Moteurs)
â”‚   â”œâ”€â”€ GPIO 32 â”€â”€â”€â–º Moteur 1 STEP
â”‚   â”œâ”€â”€ GPIO 36 â”€â”€â”€â–º Moteur 1 DIR
â”‚   â”œâ”€â”€ GPIO 33 â”€â”€â”€â–º Moteur 2 STEP
â”‚   â””â”€â”€ GPIO 31 â”€â”€â”€â–º Moteur 2 DIR
â”‚
â””â”€â”€ I2C1 (IMU)
    â”œâ”€â”€ SDA (GPIO 2)  â—„â”€â–º LSM6DSOX SDA
    â””â”€â”€ SCL (GPIO 3)  â—„â”€â–º LSM6DSOX SCL


```

## Cycle de ContrÃ´le âš¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          â”‚
â”‚  BOUCLE PRINCIPALE (50ms)                â”‚
â”‚                                          â”‚
â”‚  1. Lire capteurs IR (8 valeurs)        â”‚
â”‚  2. DÃ©tecter position de ligne          â”‚
â”‚  3. Calculer correction nÃ©cessaire      â”‚
â”‚  4. Commander les moteurs               â”‚
â”‚  5. [Optionnel] Lire IMU                â”‚
â”‚  6. Attendre 50ms                       â”‚
â”‚  7. RÃ©pÃ©ter                             â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


```

## Ã‰tats du Robot ğŸ¤–

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INITIALISE  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   EN ROUTE  â”‚â—„â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
           â”‚            â”‚
      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”‚
      â”‚         â”‚       â”‚
      â–¼         â–¼       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ LIGNE   â”‚ â”‚ LIGNE   â”‚ â”‚
â”‚ PERDUE  â”‚ â”‚ TROUVÃ‰E â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
      â”‚         â”‚       â”‚
      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ARRÃŠTÃ‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


```

## DÃ©pendances ğŸ“š

```
Projet
â”‚
â”œâ”€â”€ RPi.GPIO
â”‚   â””â”€â”€ ContrÃ´le des GPIO pour moteurs
â”‚
â”œâ”€â”€ spidev
â”‚   â””â”€â”€ Communication SPI avec MCP3208
â”‚
â””â”€â”€ smbus2
    â””â”€â”€ Communication I2C avec LSM6DSOX
```

---
